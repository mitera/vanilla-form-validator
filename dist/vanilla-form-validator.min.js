"use strict";class FormValidator{constructor(e,t){if(this.messages={required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",number:"Please enter a valid number.",phone:"Please enter a valid phone.",file:"Please select a file.",equalTo:"Please enter the same value again.",maxlength:"Please enter no more than {0} characters.",minlength:"Please enter at least {0} characters.",rangelength:"Please enter a value between {0} and {1} characters long",max:"Please enter a value than {0}.",min:"Please enter a value at least {0}.",range:"Please enter a value between {0} and {1}",regExp:"Please enter a value matching the requested format."},this.form=document.querySelector(e),this.form){let a={ignore:null,rules:null,errorElement:"p",errorClass:"error",errorFieldClass:null,validFormClass:"was-validated",submitHandler:null,messages:this.messages};this.settings=Object.assign(Object.assign({},a),t),this.messages=this.merge(this.settings.messages,this.messages),this.init()}}loadMessages(e){fetch(e).then(t=>t.json()).then(t=>{this.settings&&t.messages&&(this.messages=this.merge(t.messages,this.messages))}).catch(t=>console.log(t))}init(){if(this.form.setAttribute("novalidate",""),this.checkSubmit(),this.fields=Array.from(this.form.querySelectorAll("input[name], textarea, select")),this.settings&&this.settings.ignore){let e=Array.from(this.form.querySelectorAll(this.settings.ignore));this.fields=this.fields.filter(t=>!e.includes(t))}this.fields.forEach(e=>{e.addEventListener("blur",this.fieldValidationEvent.bind(this)),e.addEventListener("keyup",this.fieldValidationEvent.bind(this)),e.addEventListener("change",this.fieldValidationEvent.bind(this))}),this.form.addEventListener("reset",e=>{this.resetForm()})}merge(e,t){if(e!=null)for(var a in e)t[a]=e[a];return t}fieldValidationEvent(e){const t=e.target;this.validateField(t)}validateField(e){let t=e.id;const a=e.name,n=e.type,o=e.pattern;switch(n){case"checkbox":case"radio":t=a;break}const g=e.value;let l=e.dataset.errorMessage?e.dataset.errorMessage:"",r="";l&&(r=l);let i=!0;if(e.hasAttribute("required")){switch(n){case"checkbox":case"radio":i=this.validateCheckboxRadio(a);break;default:i=this.validateText(g)}!i&&!l&&(r=this.messages.required)}if(i&&g&&g!==""){switch(n){case"email":i=this.validateEmail(g),!i&&!l&&(r=this.messages.email);break;case"tel":i=this.validatePhone(g),!i&&!l&&(r=this.messages.phone);break;case"url":i=this.validateUrl(g),!i&&!l&&(r=this.messages.url);break;case"file":i=!!(e.files&&e.files.length>0),!i&&!l&&(r=this.messages.file);break;case"date":i=this.validateDate(e),!i&&!l&&(r=this.messages.date);break;default:let s=e.getAttribute("minlength")?e.getAttribute("minlength"):e.getAttribute("min");s&&this.validateDigits(s)&&(i=this.minlength(g,e,parseInt(s)),!i&&!l&&(e.getAttribute("min")?r=this.messages.min.replace("{0}",s):r=this.messages.minlength.replace("{0}",s)));let h=e.getAttribute("maxlength")?e.getAttribute("maxlength"):e.getAttribute("max");h&&this.validateDigits(h)&&(i=this.maxlength(g,e,parseInt(h)),!i&&!l&&(e.getAttribute("max")?r=this.messages.max.replace("{0}",h):r=this.messages.maxlength.replace("{0}",h))),s&&this.validateDigits(s)&&h&&this.validateDigits(h)&&(i=this.rangelength(g,e,[parseInt(s),parseInt(h)]),!i&&!l&&(e.getAttribute("max")&&e.getAttribute("min")?r=this.messages.range.replace("{0}",s).replace("{1}",h):r=this.messages.rangelength.replace("{0}",s).replace("{1}",h)))}i&&g&&g!==""&&o!==""&&(i=this.validateRegExp(o,g),!i&&!l&&(r=this.messages.regExp)),i&&this.settings&&this.settings.rules&&this.settings.rules.forEach(s=>{if(s.fieldName==a&&s.validation){let h=s.validation.min,d=s.validation.max;switch(s.validation.method){case"equalTo":if(s.validation.field){let f=this.form.querySelector(s.validation.field);f&&(i=g==f.value,!i&&!l&&(r=s.errorMessage?s.errorMessage:this.messages.equalTo))}break;case"minlength":h&&(i=this.minlength(g,e,h),!i&&!l&&(e.getAttribute("min")?r=s.errorMessage?s.errorMessage:this.messages.min:r=s.errorMessage?s.errorMessage:this.messages.minlength,r=r.replace("{0}",h.toString())));break;case"maxlength":d&&(i=this.maxlength(g,e,d),!i&&!l&&(e.getAttribute("max")?r=s.errorMessage?s.errorMessage:this.messages.max:r=s.errorMessage?s.errorMessage:this.messages.maxlength,r=r.replace("{0}",d.toString())));break;case"rangelength":h&&d&&(i=this.rangelength(g,e,[h,d]),!i&&!l&&(e.getAttribute("max")&&e.getAttribute("min")?r=s.errorMessage?s.errorMessage:this.messages.range:r=s.errorMessage?s.errorMessage:this.messages.rangelength,r=r.replace("{0}",h.toString()).replace("{1}",d.toString())));break;case"custom":s.validation.action&&(i=s.validation.action(),!i&&!l&&(r=s.errorMessage?s.errorMessage:this.messages.remote));break}}})}let c=(t||a)+"-error",m=document.querySelector("#"+c);if(!m&&this.settings){const s=document.createElement(this.settings.errorElement?this.settings.errorElement:"p");s.className=this.settings.errorClass?this.settings.errorClass:"error",s.id=c,e.insertAdjacentElement("afterend",s),m=document.querySelector("#"+c)}return m&&(i?(m&&m.style.setProperty("display","none"),this.settings&&this.settings.errorFieldClass&&e.classList.remove(this.settings.errorFieldClass)):(m.innerText=r,m&&m.style.setProperty("display",""),this.settings&&this.settings.errorFieldClass&&e.classList.add(this.settings.errorFieldClass))),i}escapeCssMeta(e){return e===void 0?"":e.replace(/([\\!"#$%&'()*+,./:;<=>?@\[\]^`{|}~])/g,"\\$1")}findByName(e){return Array.from(this.form.querySelectorAll("[name='"+this.escapeCssMeta(e)+"']"))}checkable(e){return/radio|checkbox/i.test(e.type)}getLength(e,t){switch(t.nodeName.toLowerCase()){case"select":return Array.from(t.querySelectorAll("option")).filter(a=>a.selected).length;case"input":if(this.checkable(t))return this.findByName(t.name).filter(a=>a.checked).length;switch(t.type){case"number":return parseInt(e);case"file":return t.files?t.files.length:0}}return e.length}minlength(e,t,a){var n=Array.isArray(e)?e.length:this.getLength(e,t);return n>=a}maxlength(e,t,a){var n=Array.isArray(e)?e.length:this.getLength(e,t);return n<=a}rangelength(e,t,a){var n=Array.isArray(e)?e.length:this.getLength(e,t);return n>=a[0]&&n<=a[1]}validateForm(){let e=!0;return this.fields&&this.fields.forEach(t=>{const a=t;this.validateField(a)||(e=!1)}),e}validateCheckboxRadio(e){let t=Array.from(this.form.querySelectorAll('input[name="'+e+'"]'));for(var a=0;a<t.length;a++)if(t[a].checked)return t.forEach(o=>{this.settings&&this.settings.errorFieldClass&&o.classList.remove(this.settings.errorFieldClass)}),!0;return!1}validateText(e){return e.length>0}validateRegExp(e,t){return new RegExp(e).test(t)}validateEmail(e){return/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)}validatePhone(e){return/^[\s]{0,2}[\+]{0,1}[\s0-9]{6,20}[\s]{0,2}$/.test(e)}validateUrl(e){return/^(?:(?:(?:https?|ftp):)?\/\/)(?:(?:[^\]\[?\/<~#`!@$^&*()+=}|:";',>{ ]|%[0-9A-Fa-f]{2})+(?::(?:[^\]\[?\/<~#`!@$^&*()+=}|:";',>{ ]|%[0-9A-Fa-f]{2})*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?$/.test(e)}validateDate(e){const t=e.value;let a=Date.parse(t);if(a){if(e.hasAttribute("min")){let n=e.getAttribute("min");if(n&&n!=""){let o=Date.parse(n);if(a<o)return!1}}if(e.hasAttribute("max")){let n=e.getAttribute("max");if(n&&n!=""){let o=Date.parse(n);if(a>o)return!1}}return!0}return!1}validateNumber(e){return/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e)}validateDigits(e){return/^\d+$/.test(e)}checkSubmit(){this.form&&this.form.addEventListener("submit",e=>{e.preventDefault(),this.submitAction()})}submitAction(){this.form&&(this.settings&&this.settings.validFormClass&&this.form.classList.add(this.settings.validFormClass),this.validateForm()?this.settings&&this.settings.submitHandler?this.settings.submitHandler():this.form.submit():(console.log("Invalid form, please check the errors."),this.settings&&this.settings.validFormClass&&this.form.classList.remove(this.settings.validFormClass)))}resetForm(){this.form&&(this.settings&&this.settings.validFormClass&&this.form.classList.remove(this.settings.validFormClass),this.form.reset())}}
